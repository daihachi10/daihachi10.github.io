<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <title>notepad</title>
    <link rel="icon" href="https://daihachi10.github.io/assets/favicon.ico">
    <link href="../../css/common.css" rel="stylesheet">
    <link href="../../css/loading.css" rel="stylesheet">
    <script src="../../js/loading.js"></script>
    <link href="./css/style.css" rel="stylesheet">
</head>

<body>
    <div id="loading">

        <div id="loadings" class="loading-overlay">
            <div class="loading-animation">
                <div class="bar purple"></div>
                <div class="bar cyan"></div>
                <div class="bar green"></div>
                <div class="bar yellow"></div>
                <div class="bar pink"></div>
            </div>
        </div>
        <!-- <div class="spinner"></div>
        <p>読み込み中...</p> -->
    </div>


    <div class="progress"></div>
    <!-- headerここから -->
    <header class="header">
        <div class="header-inner">
            <a class="header-logo" href="./index.html">

                <p>daihachi</p>
            </a>
            <button class="toggle-menu-button"></button>
            <div class="header-site-menu">
                <nav class="site-menu">
                    <ul>
                        <li><a href="./install.html">INSTALL APP</a></li>
                        <li><a href="./program.html">MY PROGRAM</a></li>
                        <li><a href="https://daihachi10-github-io.translate.goog/index.html?_x_tr_sl=ja&_x_tr_tl=en&_x_tr_hl=ja"
                                target="_blank">ENGLISH</a></li>
                        <li><a href="https://trans.hiragana.jp/ruby/https://daihachi10.github.io"
                                target="_blank">HIRAGANA</a></li>
                        <!--
                                    <li><a href="https://www.youtube.com/channel/UCv92oIWF2kjqRTV0EyIGjOA"
                                        target="_blank">YOUTUBE</a></li>
                                        -->
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    <!-- headerここまで -->
    <div class="setumei" contenteditable="true">
        <h1 class="reset">テキストを編集</h1>
    </div>

    <div class="buttons">
        <button onclick="saveTextFile()" class="button">.txtとして保存</button>
        <button onclick="copyText()" class="button">コピー</button>
        <input type="file" id="imageUpload" accept="image/*" onchange="insertImage()" style="display:none;">
        <button onclick="document.getElementById('imageUpload').click()" class="button">画像をアップロード</button>
    </div>

    <script>
        // Load saved content on page load
        window.addEventListener('DOMContentLoaded', () => {
            const savedContent = localStorage.getItem('notepadContent');
            if (savedContent) {
                document.querySelector('.setumei').innerHTML = savedContent;
            }
        });

        // Save content automatically to localStorage on input
        document.querySelector('.setumei').addEventListener('input', () => {
            const content = document.querySelector('.setumei').innerHTML;
            localStorage.setItem('notepadContent', content);
        });

        // Add spaces when Tab is pressed
        document.querySelector('.setumei').addEventListener('keydown', (event) => {
            if (event.key === 'Tab') {
                event.preventDefault();
                document.execCommand('insertText', false, '  ');
            }
        });

        // Save text as a .txt file
        function saveTextFile() {
            const content = document.querySelector('.setumei').innerText;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'notepad.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Copy text to clipboard
        function copyText() {
            const content = document.querySelector('.setumei').innerText;
            navigator.clipboard.writeText(content)
                .then(() => alert("テキストがコピーされました"))
                .catch((error) => console.error("コピーに失敗しました:", error));
        }

        // Insert image at the end of the editable div
        function insertImage() {
            const fileInput = document.getElementById('imageUpload');
            const file = fileInput.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.maxWidth = '50%';
                    img.style.height = 'auto';

                    // Append image to the contenteditable div
                    document.querySelector('.setumei').appendChild(img);

                    // Save the updated content to localStorage
                    const content = document.querySelector('.setumei').innerHTML;
                    localStorage.setItem('notepadContent', content);
                };

                reader.readAsDataURL(file);
            }
        }
    </script>
</body>

</html>